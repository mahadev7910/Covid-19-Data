create or replace function countryData() RETURNS trigger as

'DECLARE

	cas float := 0;
	act float := 0;
	rec float := 0;
	dea float := 0;
	rrate float := 0;
	drate float := 0;
	
BEGIN
	
	SELECT INTO cas,act,rec,dea SUM(cases),SUM(active),SUM(recovered),SUM(deaths)
	FROM state_health_department
	WHERE state_health_department.country_code = new.country_code;
	
	rrate := (rec/(cas-dea))*100;
	drate := (dea/cas)*100;
	
	UPDATE indian_health_department SET cases = cas,active = act,recovered = rec,deaths = dea,recovery_rate = rrate,death_rate = drate
	WHERE country_code = new.country_code;
	RETURN null;
	
END;
'LANGUAGE 'plpgsql';

CREATE TRIGGER countryUpdate AFTER INSERT OR UPDATE ON state_health_department
FOR EACH ROW EXECUTE PROCEDURE countryData();	

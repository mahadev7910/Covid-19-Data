create or replace function stateData() RETURNS TRIGGER AS
'DECLARE 
	total float := 0;
	act float := 0;
	reco float := 0;
	de float := 0;
	rrate float := 0;
	drate float := 0;
	
BEGIN
	SELECT INTO total,act,reco,de SUM(cases),SUM(active),SUM(recovered),SUM(deaths) 
	FROM municipal_corporation 
	WHERE municipal_corporation.state_code = new.state_code;
	
	rrate := (reco/(total-de))*100;
	drate := (de/total)*100;
		
	UPDATE state_health_department SET cases = total,active = act,recovered = reco,deaths = de,recovery_rate = rrate,death_rate = drate 
	WHERE state_health_department.state_code = new.state_code;
		
	RETURN null;

END;
'LANGUAGE 'plpgsql';

CREATE TRIGGER stateUpdate after insert or update on municipal_corporation
FOR EACH ROW EXECUTE PROCEDURE stateData();




			
				
